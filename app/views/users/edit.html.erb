<div class="container mt-5">
  <div class="row">
    <div class="col-12 col-lg-9">
      <h1>Setup your page</h1>
    </div>
    <div class="col-12 text-end col-lg-3">
      <% if !@user.username.nil? %>
        <button onclick="copyProfileLink()" class="btn btn-outline-secondary">
          <i class="bi bi-clipboard-plus me-2"></i>Copy your profile link
        </button>
      <% end %>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-6 col-lg-3">
      <div class="card">
        <div class="card-header">
          Unique Visitors
        </div>
        <div class="card-body">
          <h5 class="card-title"><%= @user.impressionist_count(filter: :ip_address) %></h5>          
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card">
        <div class="card-header">
          Page Views
        </div>
        <div class="card-body">
          <h5 class="card-title"><%= @user.impressionist_count %></h5>          
        </div>
      </div>
    </div>
  </div>
  <div class="row g-3 mt-3">
    <div class="col-12 col-md-6">
      <div class="card mb-3">
        <div class="card-header"><i class="bi bi-person-badge me-2"></i>Profile Details</div>
        <%= image_tag @user.avatar, class: "user-avatar d-block mx-auto my-3 col-3 rounded-circle object-fit-cover" if @user.avatar.attached? %>
        <%= simple_form_for(@user, url: registration_path(@user), html: { method: :put }) do |f| %>
          <div class="card-body">
            <%= f.error_notification %>
            <div class="form-inputs">
              <%= f.input :avatar, required: false, label: "Upload your profile photo" %>
              <%= f.input :username, wrapper: :input_group, placeholder: "Your username", label: "Username", class: "form-control mb-3 rounded-3", required: true, prepend: "@" %>
              <%= f.input :full_name, placeholder: "Your full name", label: "Full name", class: "form-control mb-3", required: false %>
              <%= f.text_area :description, placeholder: "About you", label: "Short description", class:"form-control mb-3", required: false %>
            </div>
          </div>
          <div class="card-footer text-body-secondary mt-3">
            <div class="form-actions d-grid">
              <%= f.button :submit, "Update Profile Details", class: "btn btn-outline-primary shadow" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <div class="col-12 col-md-6">
      <div class="card">
        <div class="card-header"><i class="bi bi-sliders me-2"></i>Page Settings</div>
        <%= simple_form_for(@user, url: registration_path(@user), html: { method: :put }) do |f| %>
          <div class="card-body">
            <div class="form-inputs">
              <div class="mb-3 d-flex justify-content-between">
                <label for="background-color" class="form-label">Background colour</label>
                <%= f.color_field :background_color, label: "Background colour", class: "form-control", style: "min-height: 24px; width:56px;" %>
              </div>
              <div class="mb-3">
                <div class="form-check form-switch d-flex justify-content-between ps-0">
                  <label class="form-check-label text-muted" for="make-profile-private">Hide profile from public</label>
                  <input class="form-check-input" type="checkbox" role="switch" id="make-profile-private" disabled>
                </div>
              </div>
              <div class="mb-3">
                <div class="form-check form-switch d-flex justify-content-between ps-0">
                  <label class="form-check-label text-muted" for="enable-ewallet">Enable e-wallet</label>
                  <input class="form-check-input" type="checkbox" role="switch" id="enable-ewallet" disabled>
                </div>
                <input type="text" class="form-control d-none" id="eWallet" placeholder="E-wallet link" disabled>
              </div>
              <div class="mb-3">
                <div class="form-check form-switch d-flex justify-content-between ps-0">
                  <label class="form-check-label text-muted" for="custom-seo">Custom SEO</label>
                  <input class="form-check-input" type="checkbox" role="switch" id="custom-seo" disabled>
                </div>
                <input type="text" class="form-control d-none" id="customSeoTitle" placeholder="Title" disabled>
                <input type="text" class="form-control d-none" id="customSeoDesc" placeholder="Description" disabled>
                <div id="customSeoDescHelpBlock" class="form-text text-end d-none">160/160</div>
              </div>
              <div class="mb-3">
                <div class="form-check form-switch d-flex justify-content-between ps-0">
                  <label class="form-check-label text-muted" for="google-analytics">Google Analytics</label>
                  <input class="form-check-input" type="checkbox" role="switch" id="google-analytics" disabled>
                </div>
                <input type="text" class="form-control d-none" id="eWallet" placeholder="G-1234567890" disabled>
              </div>
            </div>
          </div>
          <div class="card-footer text-body-secondary">
            <div class="form-actions d-grid">
              <%= f.button :submit, "Update Page Settings", class: "btn btn-outline-primary shadow" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <div class="col-12 d-flex align-items-stretch">
      <div class="card mb-3 w-100">
        <div class="card-header"><i class="bi bi-emoji-heart-eyes me-2"></i>Preview</div>
          <div class="card-body" style="background-color: <%=@user.background_color %>">
            <%= render 'profile', user: @user %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function copyProfileLink() {
    /* Copy user profile link into clipboard */
    const app_url = "<%= request.base_url %>"
    const username = "<%= @user.username %>"
    navigator.clipboard.writeText(app_url + "/" + username);
  }
</script>
